<!doctype html>
<html lang="zxx">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>aranoz</title>
  <link rel="icon" href="../../img/favicon.png">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <!-- animate CSS -->
  <link rel="stylesheet" href="../../css/animate.css">
  <!-- owl carousel CSS -->
  <link rel="stylesheet" href="../../css/owl.carousel.min.css">
  <link rel="stylesheet" href="../../css/lightslider.min.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="../../css/all.css">
  <!-- flaticon CSS -->
  <link rel="stylesheet" href="../../css/flaticon.css">
  <link rel="stylesheet" href="../../css/themify-icons.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="../../css/magnific-popup.css">
  <!-- style CSS -->
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-zoom/1.7.21/jquery.zoom.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

  <style>
  .main-image-container {
    text-align: center;
}

.main-image {
    width: 80%;
    height: auto;
    padding: 5px;
}

.small-image-container {
    text-align: center;
}

.small-image {
    max-width: 100%;
    height: 100px; /* Adjust the height for thumbnails */
    cursor: pointer;
    border: 1px solid #ddd;
    padding: 5px;
    transition: transform 0.3s;
}

.small-image:hover {
    transform: scale(1.1);
}
@keyframes blink {
    0% { opacity: 1; color: red; }
    50% { opacity: 0; color: red; }
    100% { opacity: 1; color: red; }
}

.blinking-text {
    animation: blink 1s infinite;
    font-weight: bold; /* Optional: to make the text stand out more */
}

</style>
</head>

<body>
    <%- include('header') %>
<
  <% if (product) { %>
  

  <!--================Single Product Area =================-->

  <div class="container padding_top">
    <div class="row s_product_inner justify-content-between">
        <div class="col-lg-7 col-xl-7">
            <div class="row">
                <!-- <div class="col-lg-9 col-xl-9">
                    <div class="product_slider_img">
                        <div id="mainImage" class="main-image-container">
                            <img id="currentImage" src="<%= product.productImage[0] %>" class="main-image img-fluid" />
                        </div>
                    </div>
                </div> -->
                <div class="col-lg-9 col-xl-9">
                  <div class="product_slider_img">
                    
                      <div id="mainImage" class="main-image-container" style="position: relative; overflow: hidden;">
                          <img id="currentImage" src="<%= product.productImage[0] %>" class="main-image img-fluid" />
                          <p><a href="/">Home</a> <span>-</span> <a href="/shop">Products</a><span>-</span><%= product ? product.productName : 'Product Unavailable' %></p>
                      </div>
                  </div>
              </div>
                <div class="col-lg-3 col-xl-3 d-flex align-items-start">
                    <div class="small_images">
                      
                        <% product.productImage.forEach((image, index) => { %>
                            <div class="small-image-container mb-3">
                                <img src="<%= image %>" class="small-image img-fluid" onclick="changeImage('<%= image %>')" />
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-5 col-xl-5">
            <div class="s_product_text">
                <h5>previous <span>|</span> next</h5>
                <h3><%= product.productName %></h3>
                 <h2><%= product.salePrice %> 
                 <% if (finalOffer > 0) { %>
                    <p class="blinking-text">Special Offer: <%= finalOffer %> Off</p>
                <% } %>
            </h2>
                <!-- <% if (product.productOffer > 0) { %>
                  <p>Offer: <%= product.productOffer %>% off</p>
              <% } %>  -->
            
           
                <ul class="list">
                    <li>
                        <a class="active" href="#">
                            <span>Category</span> : <%= product.category.name %>
                        </a>
                    </li>
                    <li>
                      <a href="#">
                        <span>Availability</span> : 
                        <% if (product.quantity > 0) { %>
                            <span style="color: green;">In Stock</span>
                        <% } else { %>
                            <span style="color: red;">Out of Stock</span>
                        <% } %>
                    </a>
                    </li>
                </ul>
                <p><%= product.description %></p>
                <div class="rating">
                  <span class="fa fa-star checked"></span>
                  <span class="fa fa-star checked"></span>
                  <span class="fa fa-star checked"></span>
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span>
                 
                </div>
                
                <div class="card_area d-flex justify-content-between align-items-center">
                  <div class="product_count">
                      <span class="inumber-decrement"> <i class="ti-minus"></i></span>
                      <input id="quantity" class="input-number" type="text" value="1" min="1" max="<%= product.quantity %>">
                      <span class="number-increment"> <i class="ti-plus"></i></span>
                  </div>
                  <button onclick="addToCart('<%= product._id %>')" class="btn_3"<% if (product.isBlocked) { %>disabled<% } %>>Add to Cart</button>
                  <a href="#" class="like_us"> <i class="ti-heart"></i> </a>
              </div>
                <div class="product-reviews">
                    <h5>Reviews</h5>
                    <p>John Doe: Great product!</p>
                    <p>Jane Smith: Highly recommended.</p>
                  </div>
            </div>
        </div>
    </div>
</div>
<% } else { %>
  <div class="container padding_top">
    <h2>Product Unavailable</h2>
    <p>The product you are looking for is currently unavailable or has been blocked.</p>
 </div>
 <% } %>
</div>
<!--================End Single Product Area =================-->
 
  <!-- product_list part start-->
  <section class="product_list best_seller">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="section_tittle text-center">
            <h2>Related Products </h2>
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-between">
        <% relatedProducts.forEach(relatedProduct => { %>
        <div class="col-lg-3 col-sm-6">
            <div class="single_product_item">
                <a href="/product/<%= relatedProduct._id %>">
                    <img src="<%= relatedProduct.productImage[0] %>" alt="<%= relatedProduct.productName %>" class="img-fluid">
                </a>
                <div class="single_product_text">
                    <h4><%= relatedProduct.productName %></h4>
                    <h3>â‚¹<%= relatedProduct.salePrice %></h3>
                </div>
            </div>
           
        </div>
        <% }) %>
      </div>
    </div>
  </section>
  <!-- product_list part end-->

  <%- include('footer') %>


  <!-- jquery plugins here-->
  <!-- jquery -->
  <script>
      function incrementQuantity(productId) {
    const quantityInput = document.getElementById(`quantity-${productId}`);
    const max = parseInt(quantityInput.max);
    if (quantityInput.value < max) {
      quantityInput.value = parseInt(quantityInput.value) + 1;
    }
  }

  function decrementQuantity(productId) {
    const quantityInput = document.getElementById(`quantity-${productId}`);
    const min = parseInt(quantityInput.min);
    if (quantityInput.value > min) {
      quantityInput.value = parseInt(quantityInput.value) - 1;
    }
  }

    function addToCart(productId) {
        console.log('addToCart function called'); // Debug log
        console.log('Product ID:', productId); // Debug log
        const quantity = document.getElementById('quantity').value;
        console.log('Quantity:', quantity); // Debug log

        fetch('/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId, quantity })
        }).then(response => {
        if (response.redirected) {
            // If the user is not authorized and the response is a redirect to the login page
            window.location.href = response.url;
            return; // Stop further processing
        }

        return response.json(); // This assumes the response is JSON if not redirected
    })
        .then(data => {
        console.log('Data received:', data); // Debug log
        if (data.success) {
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: 'Product added to cart successfully!',
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                // const cartCountElement = document.getElementById('cart-count');
                // const currentCount = parseInt(cartCountElement.innerText);
                // cartCountElement.innerText = currentCount + parseInt(quantity);
                 const cartCountElement = document.getElementById('cart-count');
            cartCountElement.innerText = data.cartCount || 0; // Set cart count from session
                // window.location.reload()
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to add product to cart',
            });
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>

  </script>
  <script src="../../js/jquery-1.12.1.min.js"></script>
  <!-- popper js -->
  <script src="../../js/popper.min.js"></script>
  <!-- bootstrap js -->
  <script src="../../js/bootstrap.min.js"></script>
  <!-- easing js -->
  <script src="js/jquery.magnific-popup.js"></script>
  <!-- swiper js -->
  <script src="../../js/lightslider.min.js"></script>
  <!-- swiper js -->
  <script src="../../js/masonry.pkgd.js"></script>
  <!-- particles js -->
  <script src="../../js/owl.carousel.min.js"></script>
  <script src="../../js/jquery.nice-select.min.js"></script>
  <!-- slick js -->
  <script src="../../js/slick.min.js"></script>
  <script src="../../js/swiper.jquery.js"></script>
  <script src="../../js/jquery.counterup.min.js"></script>
  <script src="../../js/waypoints.min.js"></script>
  <script src="../../js/contact.js"></script>
  <script src="../../js/jquery.ajaxchimp.min.js"></script>
  <script src="../../js/jquery.form.js"></script>
  <script src="../../js/jquery.validate.min.js"></script>
  <script src="../../js/mail-script.js"></script>
  <script src="../../js/stellar.js"></script>
  <!-- custom js -->
  <script src="../../js/theme.js"></script>
  <script src="../../js/custom.js"></script>

  <!-- custom for images -->
  <script>
    function changeImage(image) {
        document.getElementById('currentImage').src = image;
    }
</script>
<!-- Initialize jQuery Zoom -->
<script>
  $(document).ready(function() {
      $('#mainImage').zoom(
        {
            magnify: 2 // Adjust magnification factor (e.g., 2 for twice the normal size)
        }
      );
  });

  function changeImage(image) {
      $('#currentImage').attr('src', image).data('zoom-image', image);
      $('#mainImage').trigger('zoom.destroy').zoom(
        {
            magnify: 2 // Adjust magnification factor
        }
      );
  }

 
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- jQuery Zoom -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-zoom/1.7.21/jquery.zoom.min.js"></script>
</body>

</html>